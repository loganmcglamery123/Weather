<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Peterson Butte Hub</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background: #f0f2f5; padding: 10px; margin: 0; }
        h1 { font-size: 1.5rem; margin: 15px 0; color: #333; }
        
        /* CARD STYLING */
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 100%; max-width: 850px; margin-bottom: 20px; text-align: center; overflow: hidden; }
        h2 { font-size: 1.2rem; color: #333; margin-top: 0; margin-bottom: 10px; }
        
        /* NEW WIND BANNER STYLES */
        .wind-banner {
            width: 100%;
            overflow-x: auto;
        }
        .wind-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }
        .wind-table th {
            background: #343a40;
            color: white;
            padding: 10px 5px;
            font-size: 0.85rem;
            text-transform: uppercase;
        }
        .wind-table td {
            padding: 12px 8px;
            border-bottom: 1px solid #eee;
            text-align: center;
            vertical-align: middle;
        }
        
        /* Highlight the Primary Station (Peterson) */
        .primary-row {
            background-color: #e8f5e9; /* Light Green Background */
            border-left: 4px solid #28a745;
        }
        .station-label {
            font-weight: bold;
            display: block;
            color: #333;
            text-align: left;
        }
        .sub-label {
            font-size: 0.75rem;
            color: #777;
            display: block;
            text-align: left;
        }
        
        /* Wind Values */
        .wind-val { font-weight: bold; color: #333; font-size: 1.1rem; }
        .gust-val { color: #d9534f; font-weight: bold; font-size: 1.1rem; }
        .unit { font-size: 0.7rem; color: #888; font-weight: normal; }
        
        /* Arrows */
        .wind-arrow-box { display: flex; flex-direction: column; align-items: center; justify-content: center; line-height: 1; }
        .arrow-icon { font-size: 1.4rem; color: #007bff; font-weight: bold; display: inline-block; }
        .cardinal-text { font-size: 0.7rem; font-weight: bold; color: #555; margin-top: 2px; }

        /* Camera Styling */
        .camera-window { width: 100%; height: 590px; position: relative; overflow: hidden; border-radius: 8px; background: #000; touch-action: pan-y; }
        .camera-window iframe { width: 100%; height: 100%; border: none; }
        
        /* Forecast Table Styling */
        .forecast-container { overflow-x: auto; border-radius: 8px; border: 1px solid #ddd; margin-top: 10px; }
        .forecast-table { width: 100%; border-collapse: collapse; background: white; font-size: 0.85rem; }
        .forecast-table th { background: #343a40; color: white; }
        .forecast-table td, .forecast-table th { padding: 10px; text-align: center; border-bottom: 1px solid #eee; }
        
        /* Windgram */
        #windgram-box img { width: 100%; height: auto; border-radius: 8px; display: block; }
        
        .refresh-btn { padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 40px; }
        
        .updated-time { font-size: 0.7rem; color: #999; margin-top: 5px; text-align: right; font-style: italic; }
    </style>
</head>
<body>

    <h1>Peterson Butte Hub</h1>

    <div class="card">
        <h2>Current Wind Conditions</h2>
        <div class="wind-banner">
            <table class="wind-table">
                <thead>
                    <tr>
                        <th style="text-align:left; padding-left:15px;">Station</th>
                        <th>Speed</th>
                        <th>Gust</th>
                        <th>Dir</th>
                    </tr>
                </thead>
                <tbody id="wind-banner-body">
                    <tr><td colspan="4">Loading Wind Data...</td></tr>
                </tbody>
            </table>
        </div>
        <div class="updated-time" id="last-update">Updating...</div>
    </div>

    <div class="card">
        <h2>Live FAA Webcam (West)</h2>
        <div class="camera-window">
            <iframe src="https://weathercams.faa.gov/map/-122.63218,44.50524,11/cameraSite/762/details/camera/12793/full" scrolling="no"></iframe>
        </div>
    </div>

    <div class="card">
        <h2>Hourly Point Forecast (NWS/HRRR)</h2>
        <div class="forecast-container">
            <table class="forecast-table" id="forecast-table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Temp</th>
                        <th>Wind</th>
                        <th>Gust</th>
                        <th>Dir</th>
                    </tr>
                </thead>
                <tbody id="forecast-body">
                    <tr><td colspan="5">Loading forecast...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="card">
        <h2>Windgram Forecast</h2>
        <div id="windgram-box">Loading...</div>
    </div>

    <button class="refresh-btn" onclick="location.reload()">Refresh Hub</button>

    <script>
        // ==========================================
        // CONFIGURATION
        // ==========================================
        const LAT = 44.51;
        const LON = -122.968889;
        
        // API KEYS
        const WU_API_KEY = 'e1f10a1e78da46f5b10a1e78da96f525'; 
        const WU_STATION = 'KORBROWN23';
        
        // *** PASTE YOUR SYNOPTIC TOKEN HERE ***
        const SYNOPTIC_TOKEN = 'bd6b13e22c96448f83932470cf8c5c07'; 
        const SYNOPTIC_STATIONS = 'KS12,KCVO,KSLE,KEUG';

        // Global store for data to combine them
        let windData = {
            peterson: null,
            regional: []
        };

        // ==========================================
        // MASTER RENDER FUNCTION
        // ==========================================
        function renderWindTable() {
            const tbody = document.getElementById('wind-banner-body');
            let html = "";

            // 1. Render Peterson Butte (Primary Row)
            if (windData.peterson) {
                const p = windData.peterson;
                html += `
                <tr class="primary-row">
                    <td style="text-align:left;">
                        <span class="station-label">Peterson Butte</span>
                        <span class="sub-label">Live Sensor</span>
                    </td>
                    <td><span class="wind-val">${p.speed}</span> <span class="unit">mph</span></td>
                    <td><span class="gust-val">${p.gust > p.speed ? p.gust : '-'}</span></td>
                    <td>
                        <div class="wind-arrow-box">
                            <span class="arrow-icon" style="transform: rotate(${p.dir}deg)">↓</span>
                            <span class="cardinal-text">${p.cardinal}</span>
                        </div>
                    </td>
                </tr>`;
            } else {
                html += `<tr><td colspan="4">Loading Peterson Butte...</td></tr>`;
            }

            // 2. Render Regional Stations
            if (windData.regional.length > 0) {
                windData.regional.forEach(st => {
                    const gustDisplay = (st.gust > st.speed && st.gust > 0) ? st.gust : '-';
                    html += `
                    <tr>
                        <td style="text-align:left;">
                            <span class="station-label">${st.name}</span>
                            <span class="sub-label">${st.age}m ago</span>
                        </td>
                        <td><span class="wind-val">${st.speed}</span></td>
                        <td><span class="gust-val">${gustDisplay}</span></td>
                        <td>
                            <div class="wind-arrow-box">
                                <span class="arrow-icon" style="transform: rotate(${st.dir}deg)">↓</span>
                                <span class="cardinal-text">${st.cardinal}</span>
                            </div>
                        </td>
                    </tr>`;
                });
            } else if (SYNOPTIC_TOKEN.includes('PUT_YOUR')) {
                html += `<tr><td colspan="4" style="color:red; font-size:0.8rem;">Missing Synoptic API Token</td></tr>`;
            }

            tbody.innerHTML = html;
            document.getElementById('last-update').
