<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wind Speed Profile</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; text-align: center; }
        .chart-container { position: relative; height: 60vh; width: 90vw; margin: 0 auto; }
    </style>
</head>
<body>

    <h1>Wind Speed Forecast</h1>
    <p>Surface to 18,000ft (if available in API response)</p>
    
    <div class="chart-container">
        <canvas id="windChart"></canvas>
    </div>

    <script>
        async function fetchData() {
            // I removed your key for safety. Paste it between the quotes below.
            const apiKey = "YOUR_API_KEY_HERE"; 
            
            // Your specific coordinates and settings
            const url = `https://my.meteoblue.com/packages/air-15min?apikey=${apiKey}&lat=44.12&lon=-123.214&asl=112&format=json&temperature=F&windspeed=mph&precipitationamount=inch&winddirection=3char&forecast_days=1`;

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                
                const json = await response.json();
                console.log("API Response:", json); // Check this in Console (F12) to see available data

                // Extract Time Labels
                // The API usually returns 'data_15min' or 'data_1h' depending on the package.
                // We check both.
                const dataBlock = json.data_15min || json.data_1h || json.data_day;
                const timeLabels = dataBlock.time.map(t => new Date(t).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}));

                // Setup Datasets
                // Note: 'air-15min' usually only has 'windspeed'. 
                // Upper air data often looks like 'windspeed_850hPa' in other packages.
                // We try to grab what is there.
                
                const datasets = [
                    {
                        label: 'Surface Wind',
                        data: dataBlock.windspeed, // The standard surface feed
                        borderColor: 'blue',
                        borderWidth: 2,
                        fill: false
                    }
                ];

                // ATTEMPT to add upper levels (18,000ft is approx 500 hPa)
                // These keys might not exist in your current 'air-15min' package.
                if (dataBlock.windspeed_500hPa) {
                    datasets.push({
                        label: '18,000ft (500hPa)',
                        data: dataBlock.windspeed_500hPa,
                        borderColor: 'red',
                        borderWidth: 2
                    });
                }
                
                if (dataBlock.windspeed_850hPa) {
                    datasets.push({
                        label: '5,000ft (850hPa)',
                        data: dataBlock.windspeed_850hPa,
                        borderColor: 'orange',
                        borderWidth: 2
                    });
                }

                renderChart(timeLabels, datasets);

            } catch (error) {
                console.error(error);
                document.body.innerHTML += `<p style="color:red">Error: ${error.message}. Check console for details.</p>`;
            }
        }

        function renderChart(labels, datasets) {
            const ctx = document.getElementById('windChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Speed (mph)' }
                        },
                        x: {
                            title: { display: true, text: 'Time' }
                        }
                    }
                }
            });
        }

        fetchData();
    </script>
</body>
</html>
